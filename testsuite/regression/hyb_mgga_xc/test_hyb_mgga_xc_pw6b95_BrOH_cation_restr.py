
import pylibxc
import pytest
import numpy
from pylibxc.example_densities import test_data

# test_hyb_mgga_xc_pw6b95_BrOH_cation_restr_1_zk() not generated due to NaN in reference data

# test_hyb_mgga_xc_pw6b95_BrOH_cation_restr_1_vrho() not generated due to NaN in reference data

# test_hyb_mgga_xc_pw6b95_BrOH_cation_restr_1_vsigma() not generated due to NaN in reference data


def test_hyb_mgga_xc_pw6b95_BrOH_cation_restr_1_vtau():
    # Prepare the input
    inp = test_data["BrOH_cation_restr"]

    # Get the functional
    feval = pylibxc.LibXCFunctional("hyb_mgga_xc_pw6b95", 1)

    # Evaluate the data
    out = feval.compute(inp, do_exc=True, do_vxc=True, do_fxc=False, do_kxc=False, do_lxc=False)
    tgt = out["vtau"].flatten()
    ref_tgt = [-3.917476094290176e-05, -3.917456290562790e-05, -3.917362137932091e-05, -3.917656909685308e-05, -3.917503319995349e-05, -3.917503319995349e-05, -9.886250054216535e-04, -9.886212963460517e-04, -9.884934715953247e-04, -9.883894443422218e-04, -9.885791352840607e-04, -1.145390909673269e-04, -1.592853529406604e-02, -6.020217245185949e-04, -4.929279670713939e-04, -5.446890624677581e-04, -5.323286827531117e-04, -5.323286827531117e-04, -2.416302732610495e-03, -2.591824356238997e-03, -1.238371199050499e-02, -6.658692831864484e-04, -1.199664083297342e-03, -1.199664083297341e-03, -3.439495988315761e-07, -4.137585200267251e-07, -2.136724484770106e-05, -5.354184412726148e-08, -1.424043656256180e-07, -1.424043656256180e-07, -2.311396099738027e-04, -2.322276916928704e-04, -2.312026934037349e-04, -4.880334250829034e-04, -2.316838442334158e-04, -2.316838442334158e-04, -2.661303104094819e-03, -2.628685277403782e-03, -2.685517452651573e-03, -2.656249081361493e-03, -2.631732964054590e-03, -2.407232926025982e-04, -4.137718249957706e-03, -6.580723367263166e-03, -3.090056287816527e-03, -4.478576558886299e-03, -4.508713932677291e-03, -1.929735692306609e-02, -3.460331214744272e-01, -1.004396484370145e-03, -3.870885540310496e-01, -6.866138775418683e-04, -5.384143429486254e-04, -5.384143429486254e-04, -3.156062561985356e+01, -4.437660793538488e-08, -1.670236046488959e-07, -6.787815240163054e-01, -2.642940795733916e+01, -1.090303325021185e-07, -1.564525412971758e-02, -1.287555304719703e-02, -1.976885817934797e-02, -1.456449021393917e-02, -1.415445472810626e-02, -1.415445472810626e-02, -1.588702989515332e-02, -4.301943004227613e-03, -6.104573542017286e-03, -8.861553930161699e-03, -7.300385675806455e-03, -2.357026059631729e-02, -5.185978078691218e-03, -9.384751940055865e-02, -2.156601495545462e-03, -4.576736496754310e-02, -3.137222344429789e-03, -3.137222344429789e-03, -3.001494066796270e-02, -1.929739302415495e-05, -3.871975403693538e-05, -6.149348283934760e-03, -4.830320359587126e-01, -2.135291164893356e-04, -4.300431025249035e-07, -1.218383193264711e-09, -2.984768107416270e-08, -1.972261010876566e-04, -1.245563981573242e-07, -1.245563981573242e-07]
    error = numpy.max(numpy.abs(tgt-ref_tgt))/(1.0+numpy.max([numpy.abs(tgt), numpy.abs(ref_tgt)]))
    assert error < 5e-05
