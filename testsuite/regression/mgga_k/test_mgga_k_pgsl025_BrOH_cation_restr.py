
import pylibxc
import pytest
import numpy
from pylibxc.example_densities import test_data

# test_mgga_k_pgsl025_BrOH_cation_restr_1_zk() not generated due to NaN in reference data

# test_mgga_k_pgsl025_BrOH_cation_restr_1_vrho() not generated due to NaN in reference data


def test_mgga_k_pgsl025_BrOH_cation_restr_1_vsigma():
    # Prepare the input
    inp = test_data["BrOH_cation_restr"]

    # Get the functional
    feval = pylibxc.LibXCFunctional("mgga_k_pgsl025", 1)

    # Evaluate the data
    out = feval.compute(inp, do_exc=True, do_vxc=True, do_fxc=False, do_kxc=False, do_lxc=False)
    tgt = out["vsigma"].flatten()
    ref_tgt = numpy.asarray([2.657435753610125e-06, 2.657367000866587e-06, 2.657129118478494e-06, 2.658150668246390e-06, 2.657605731630764e-06, 2.657605731630764e-06, 7.444719181693107e-04, 7.443794949499742e-04, 7.421873343147567e-04, 7.455725369923753e-04, 7.443072783604594e-04, 7.443072783604594e-04, 1.374931699335458e-01, 1.387916597715740e-01, 1.725636423629326e-01, 1.673762849194891e-01, 1.676850580127171e-01, 1.676850580127171e-01, 1.193212455190515e+01, 1.134875168833884e+01, 8.178660949250080e-02, 2.771297209375232e+01, 1.953516900512177e+01, 1.953516900512178e+01, 2.874952765754122e+05, 2.465546137483149e+05, 1.468181512983259e+03, 1.492465251230529e+06, 7.522070256195636e+05, 7.522070256195636e+05, 1.522447037666083e-04, 1.514554890783927e-04, 1.522113870628737e-04, 1.515146167629040e-04, 1.518429464263411e-04, 1.518429464263411e-04, 6.549727330206403e-03, 6.350129899235482e-03, 6.791576510877441e-03, 6.610321803337663e-03, 6.323236078284687e-03, 6.323236078284687e-03, 1.420249906390372e-01, 5.380066560452619e-02, 1.936352293527043e-01, 9.057304538987443e-02, 1.267065034727309e-01, 1.267065034727309e-01, 8.282011696864036e+01, 1.205660589743946e+01, 1.046004417136014e+02, 1.917006523813090e-03, 5.124461602555305e+01, 5.124461602555305e+01, 3.249256950004610e+06, 1.597482152034641e+06, 3.573149841128374e+06, 3.437938582102904e+02, 2.043738650702208e+06, 2.043738650702208e+06, 4.619427401394000e-02, 6.760819262993260e-02, 6.013766973571144e-02, 5.390507104998704e-02, 5.702687421782188e-02, 5.702687421782188e-02, 4.334809434949627e-02, 3.423625636375341e-01, 2.365646839875352e-01, 1.466733538693065e-01, 1.898580108795344e-01, 1.898580108795344e-01, 4.880898834047775e-02, 5.917157275974327e+00, 3.266210784210736e+00, 1.050065138852581e+00, 1.935078670557683e+00, 1.935078670557683e+00, 4.447257815915788e-01, 1.674445854271037e+03, 6.607838326576669e+02, 9.874954776493788e-01, 1.665281126257556e+02, 1.665281126257556e+02, 1.022742173599572e+05, 8.363882291868500e+07, 9.043637243187241e+06, 2.011089761174651e+02, 2.579643228134502e+06, 2.579643228134509e+06])
    error = numpy.max(numpy.abs(tgt-ref_tgt))/(1.0+numpy.max([numpy.abs(tgt), numpy.abs(ref_tgt)]))
    assert error < 5e-05

# test_mgga_k_pgsl025_BrOH_cation_restr_1_vlapl() not generated due to NaN in reference data
